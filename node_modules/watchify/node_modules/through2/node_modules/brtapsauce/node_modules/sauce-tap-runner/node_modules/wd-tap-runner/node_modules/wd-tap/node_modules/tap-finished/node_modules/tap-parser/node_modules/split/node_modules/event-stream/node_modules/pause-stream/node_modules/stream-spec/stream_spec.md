# a `Stream` spec

This document defines the behaviour that a `Stream` must implement in order to be compatible with `Stream#pipe`. This is not an official document, but is intended as a guide to produce correct behaviour in user-land streams.

## Stream

All streams *must* emit `'error'` if writing to or reading from becomes physically impossible. `'error'` implys that the stream has ended.

All streams *may* emit `'close'`. `'close'` means that any underlying resources have been disposed of. If a `ReadableStream` has ended normally, it *must not* emit `'close'` before `'end'`.

A `Stream` *must not* emit `'error'` if the error is recoverable. 
(that is not in the stream spec)

All streams *should* implement `destroy` but a `WritableStream` *must* implement `destroy`.

### emit('error')

All streams *must* emit `'error'` when an error that is not recoverable has occurred. If it has become physically impossible to write to or read from the `Stream`, then emit `'error'`.

A `WriteableStream` *may* throw an error if `write` has been called after `end`.
(which should never happen, in correct usage)

otherwise, a stream *must never* throw an error. (always emit)

## WritableStream

A `WritableStream` *must* implement methods `write`, `end`, and `destroy`, and `writable` *must* be set to `true`, and *must* inherit `Stream#pipe`

### write(data)

`write` must return either `true` or `false`.
(if `false` then the writer *should* pause)
If `write` is called after end, an error *may* be thrown.

If `write` returns `false`,it *must* eventually emit `'drain'`. `write` returning `false` means the stream is paused. paused means (or downstream) is at capacity, and the writer/upstream *should attempt* to slow down or stop. It does not mean buffer, although that is something a stream may reasonably do.

### end()

Calling `end` *must* set `writable` to `false`. 
If the `Stream` is also readable, it *must* eventually emit `'end'`, and then `'close'`.
If the `Stream` in not also readable, it *must* eventually emit `'close'` but not emit `'end'`.

### destroy()

Used to dispose of a `Stream`.

Calling `destroy` *must* dispose of any underlying resources.
Calling `destroy` *must* emit `'close'` eventually, 
once any underlying resources are disposed of.


### emit ('drain')

After pausing, a `Stream` must eventually emit `'drain'`. For example, when if a call to `write` returns `false` `Stream#pipe` will call `pause` on the source and  register a one-time listener on `drain`, that will call `resume` on the source.

If drain is not emitted correctly, it's possible for `'data'` events to stop coming (depending on the source's behaviour when paused).

## ReadableStream

A `ReadableStream` *must* inherit `pipe` from `Stream`, and set `readable` to `true`, and *must* emit zero or more 'data' events, followed by a single `end` event. A `ReadableStream` *may* implement `pause` and `resume` methods.

* I will not bother to specify the behaviour of `pipe` because I am attempting to document what must be done in order for your `Stream` to be comp